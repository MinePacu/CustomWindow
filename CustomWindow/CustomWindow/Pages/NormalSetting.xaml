<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CustomWindow.Pages.NormalSetting"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CustomWindow.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">

    <Grid
        HorizontalAlignment="Stretch"
        MaxWidth="990">
        <ScrollViewer
            HorizontalAlignment="Stretch"
            IsDeferredScrollingEnabled="True"
            VerticalScrollBarVisibility="Visible"
            MaxWidth="990"
            Margin="0, 20, 0, 20">
            <StackPanel 
                 x:Name="Panel"
                 HorizontalAlignment="Stretch">

                <controls:SettingsCard
                    Header="윈도우 설정 자동 변경"
                    Description="윈도우 설정을 자동으로 변경합니다."
                    Margin="0, 0, 0, 3">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon 
                            FontFamily="Segoe Fluent Icons" 
                            Glyph="&#xe943;"/>
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch 
                        IsOn="{x:Bind ViewModel.AutoWindowChange, Mode=TwoWay}"/>
                </controls:SettingsCard>

                <!-- BorderService 상태 표시 -->
                <controls:SettingsCard
                    Header="테두리 서비스 상태"
                    Description="{x:Bind ViewModel.BorderServiceStatusText, Mode=OneWay}"
                    Margin="0, 0, 0, 3">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon 
                            FontFamily="Segoe Fluent Icons" 
                            Glyph="&#xE9D5;"
                            Foreground="{x:Bind ViewModel.BorderServiceAvailable, Mode=OneWay, Converter={StaticResource BoolToSuccessColorConverter}}"/>
                    </controls:SettingsCard.HeaderIcon>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button 
                            Content="다시 그리기" 
                            Click="ForceRedrawBorders_Click"
                            IsEnabled="{x:Bind ViewModel.AutoWindowChange, Mode=OneWay}"/>
                        <Button 
                            Content="상태 확인" 
                            Click="CheckBorderServiceStatus_Click"/>
                    </StackPanel>
                </controls:SettingsCard>

                <!-- New: BorderService 콘솔 표시 설정 -->
                <controls:SettingsCard
                    Header="BorderService 콘솔 표시"
                    Description="CustomWindow에서 실행할 때 콘솔 창을 표시합니다. (재시작 필요)"
                    Margin="0,0,0,3">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE7F4;"/>
                    </controls:SettingsCard.HeaderIcon>
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.ShowBorderServiceConsole, Mode=TwoWay}"/>
                </controls:SettingsCard>

                <!-- New: Render method selection for debugging -->
                <controls:SettingsCard
                    Header="테두리 렌더 방식"
                    Description="개발용: 운영체제 버전 무시하고 DWM/DComp 중 선택"
                    Margin="0,0,0,3">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE9A2;"/>
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox SelectedItem="{x:Bind ViewModel.BorderRenderMode, Mode=TwoWay}">
                        <x:String>Auto</x:String>
                        <x:String>Dwm</x:String>
                        <x:String>DComp</x:String>
                    </ComboBox>
                </controls:SettingsCard>

                <controls:SettingsExpander
                    Header="제외 프로그램"
                    Description="제외할 프로그램 목록"
                    x:Name="NonProgram_Expander"
                    Margin="0, 0, 0, 3"
                    ToolTipService.ToolTip="색상을 적용하지 않을 프로그램을 설정합니다.&#10;&#10;각 프로그램에 대해서 어떤 기능을 제외할지를 수동으로 설정할 수 있습니다.&#10;/b - 모서리 색상을 적용하지 않습니다.&#10;/c - 캡션 색을 적용하지 않습니다.&#10;/t - 캡션 텍스트 색을 적용하지 않습니다.">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xed35;"/>
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard
                            ContentAlignment="Vertical"
                            HorizontalContentAlignment="Stretch">
                            <TextBox 
                                TextWrapping="Wrap"
                                AcceptsReturn="True" 
                                Text="{x:Bind ViewModel.ExcludedProgramList, Mode=TwoWay}"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                ScrollViewer.VerticalScrollMode="Auto"/>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <TextBlock Text="윈도우 설정" 
                   Margin="0, 14, 0, 4" 
                   FontSize="14" 
                   FontWeight="Bold" />

                <controls:SettingsCard 
                    Header="창 모서리 설정">
                    <ComboBox
                        SelectedItem="{x:Bind ViewModel.WindowCornerMode, Mode=TwoWay}">
                        <x:String>기본</x:String>
                        <x:String>둥글게 하지 않음</x:String>
                        <x:String>둥글게</x:String>
                        <x:String>덜 둥글게</x:String>
                    </ComboBox>
                </controls:SettingsCard>
                <TextBlock
                    Text="권한" 
                    FontWeight="Bold"
                    Margin="0, 0, 0, 7"/>
                <controls:SettingsExpander
                    Header="관리자 권한으로 실행"
                    Margin="0, 0, 0, 3">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon 
                             FontFamily="Segoe Fluent Icons"
                            Glyph="&#xe713;"/>
                    </controls:SettingsExpander.HeaderIcon>
                    <Button 
                        x:Name="RestartWithAdminbutton"
                        Content="관리자 권한으로 다시 시작"
                        Click="RestartWithAdminbutton_Click"/>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard
                            Header="자동으로 관리자 권한으로 시작"
                            Description="프로그램을 열면 자동으로 관리자 권한을 부여합니다.">
                            <ToggleSwitch
                                x:Name="AutoAdminToggle"
                                IsOn="{x:Bind ViewModel.AutoAdmin, Mode=TwoWay}"/>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>

                <TextBlock
                    Text="기타 설정"
                    FontWeight="Bold"
                    Margin="0, 14, 0, 7" />
                <controls:SettingsCard
                    Header="최소화"
                    Description="창을 닫아도 트레이 아이콘으로 최소화하여 프로그램을 끄지 않습니다."
                    Margin="0, 0, 0, 3">
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.MinimizeToTray, Mode=TwoWay}" />
                </controls:SettingsCard>
                <controls:SettingsCard
                    Header="기본값으로 복원"
                    Description="종료 시 모든 윈도우 설정을 기본값으로 복원"
                    Margin="0, 0, 0, 3" >
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.RestoreDefaultsOnExit, Mode=TwoWay}" />
                </controls:SettingsCard>
                <controls:SettingsCard
                    Header="부팅 시 자동 실행"
                    Margin="0, 0, 0, 3">
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.RunOnBoot, Mode=TwoWay}" />
                </controls:SettingsCard>
                <controls:SettingsCard
                    Header="커스텀 타이틀 바"
                    Margin="0, 0, 0, 3" >
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.UseCustomTitleBar, Mode=TwoWay}" />
                </controls:SettingsCard>

                <controls:SettingsExpander
                    Header="자동 변경 추적 로그"
                    Description="AutoWindowChange 동작 중 수집된 창 추적 로그"
                    Margin="0,10,0,0">
                    <controls:SettingsExpander.HeaderIcon>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE7BA;"/>
                    </controls:SettingsExpander.HeaderIcon>
                    <controls:SettingsExpander.Items>
                        <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <TextBox
                                    x:Name="WindowTrackerLogBox"
                                    IsReadOnly="True"
                                    TextWrapping="NoWrap"
                                    FontFamily="Consolas"
                                    MinHeight="140"
                                    MaxHeight="240"
                                    AcceptsReturn="True"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                                    ScrollViewer.HorizontalScrollBarVisibility="Auto"/>
                                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,6,0,0">
                                    <Button Content="새로고침" Click="RefreshWindowTrackerLogs_Click"/>
                                    <Button Content="복사" Click="CopyWindowTrackerLogs_Click"/>
                                    <Button Content="지우기" Click="ClearWindowTrackerLogs_Click"/>
                                </StackPanel>
                        </Grid> 
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</Page>
